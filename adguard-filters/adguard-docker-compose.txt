
sudo systemctl stop systemd-resolved
sudo systemctl disable systemd-resolved

sudo nano /etc/systemd/resolved.conf

[Resolve]
DNS=1.1.1.1
DNSStubListener=no

sudo mv /etc/resolv.conf /etc/resolv.conf.backup
sudo ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf

mkdir adguard && cd adguard
nano docker-compose.yml

version: "3"
services:
  
  dnscrypt:
    container_name: dnscrypt-proxy
    image: klutchell/dnscrypt-proxy:latest
    ports:
      - "5300:5300/udp"
      - "5300:5300/tcp"
    #environment:
      # TZ: ''
    volumes:
      - './etc-dnscrypt-proxy:/config'
      # ./etc-dnscrypt-proxy/dnscrypt-proxy.toml
    dns:
      - 1.1.1.1
    restart: unless-stopped
    networks:
      - adguard_net

  adguardhome:
    image: adguard/adguardhome
    container_name: adguardhome
    ports:
      - 53:53/tcp # DNS
      - 53:53/udp # DNS
      - 853:853/tcp # DNS
      - 3123:3000/tcp # DashBoard Setup, do not change 80
      - 5449:5443/tcp
      - 3080:80/tcp
      - 3443:443/tcp
    volumes:
      - ./workdir:/opt/adguardhome/work
      - ./confdir:/opt/adguardhome/conf
    restart: unless-stopped
    dns:
      - "127.0.0.1#5300"
    networks:
      - adguard_net
    depends_on:
      - dnscrypt

networks:
  adguard_net:
    driver: bridge

